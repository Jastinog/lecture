{% load static %}
{% load static_hash %}

<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <script>
        (function() {
            const theme = localStorage.getItem('theme') || 'dark';
            document.documentElement.className = theme;
        })();
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>{% block title %}Lecture System{% endblock %}</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        ayu: {
                            bg0: 'var(--bg-0)',
                            bg1: 'var(--bg-1)',
                            bg2: 'var(--bg-2)',
                            bg3: 'var(--bg-3)',
                            bg4: 'var(--bg-4)',
                            fg0: 'var(--fg-0)',
                            fg1: 'var(--fg-1)',
                            fg2: 'var(--fg-2)',
                            fg3: 'var(--fg-3)',
                            fg4: 'var(--fg-4)',
                            red: 'var(--red)',
                            redBright: 'var(--red-bright)',
                            green: 'var(--green)',
                            greenBright: 'var(--green-bright)',
                            yellow: 'var(--yellow)',
                            yellowBright: 'var(--yellow-bright)',
                            blue: 'var(--blue)',
                            blueBright: 'var(--blue-bright)',
                            purple: 'var(--purple)',
                            purpleBright: 'var(--purple-bright)',
                            aqua: 'var(--aqua)',
                            aquaBright: 'var(--aqua-bright)',
                            orange: 'var(--brand)',
                            orangeBright: 'var(--brand-2)',
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="{% static_hash 'css/base.css' %}">
    <link rel="stylesheet" href="{% static_hash 'css/layout.css' %}">
    <link rel="stylesheet" href="{% static_hash 'css/components.css' %}">
    {% block extra_css %}{% endblock %}
</head>
<body class="min-h-screen bg-ayu-bg0 text-ayu-fg1">
    <header class="bg-ayu-bg1 border-b border-ayu-bg3">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-14 md:h-16">
                <!-- Logo -->
                <a href="{% url 'lecture:home' %}" class="flex items-center space-x-2 sm:space-x-3 flex-shrink-0">
                    <img src="{% static 'image/logo.png' %}" alt="Logo" class="w-9 h-9 sm:w-11 sm:h-11">
                    <div class="flex flex-col leading-tight">
                        <span class="text-sm sm:text-lg font-semibold text-ayu-fg0 whitespace-nowrap">New Purushottama Kshetra</span>
                        <span class="text-xs text-ayu-fg4 hidden sm:block">Ukraine</span>
                    </div>
                </a>

                <!-- Desktop Navigation -->
                <div class="desktop-nav items-center space-x-4" style="display: none;">
                    <nav class="flex items-center space-x-1">
                        <a href="{% url 'lecture:home' %}"
                           class="text-ayu-fg3 hover:text-ayu-fg0 hover:bg-ayu-bg2 px-3 py-2 rounded-lg text-sm font-medium transition-all">
                            <i class="fas fa-home mr-1.5 text-ayu-fg4"></i>Главная
                        </a>
                        <a href="{% url 'lecture:lecturers_list' %}"
                           class="text-ayu-fg3 hover:text-ayu-fg0 hover:bg-ayu-bg2 px-3 py-2 rounded-lg text-sm font-medium transition-all">
                            <i class="fas fa-users mr-1.5 text-ayu-fg4"></i>Лекторы
                        </a>
                        <a href="{% url 'lecture:topics_list' %}"
                           class="text-ayu-fg3 hover:text-ayu-fg0 hover:bg-ayu-bg2 px-3 py-2 rounded-lg text-sm font-medium transition-all">
                            <i class="fas fa-book mr-1.5 text-ayu-fg4"></i>Темы
                        </a>
                        <a href="{% url 'lecture:now_listening_list' %}"
                           class="text-ayu-fg3 hover:text-ayu-fg0 hover:bg-ayu-bg2 px-3 py-2 rounded-lg text-sm font-medium transition-all">
                            <i class="fas fa-headphones mr-1.5 text-ayu-fg4"></i>Слушают
                        </a>
                        {% if user.is_authenticated %}
                        <a href="{% url 'lecture:favorites_list' %}"
                           class="text-ayu-fg3 hover:text-ayu-fg0 hover:bg-ayu-bg2 px-3 py-2 rounded-lg text-sm font-medium transition-all">
                            <i class="fas fa-heart mr-1.5 text-ayu-red"></i>Избранное
                        </a>
                        <a href="{% url 'lecture:history_list' %}"
                           class="text-ayu-fg3 hover:text-ayu-fg0 hover:bg-ayu-bg2 px-3 py-2 rounded-lg text-sm font-medium transition-all">
                            <i class="fas fa-history mr-1.5 text-ayu-fg4"></i>История
                        </a>
                        {% endif %}
                    </nav>

                    <!-- Theme Toggle Desktop -->
                    <button id="theme-toggle" type="button"
                            class="relative w-12 h-6 rounded-full bg-ayu-bg3 hover:bg-ayu-bg4 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-ayu-orange/50"
                            aria-label="Toggle theme">
                        <span id="theme-toggle-thumb"
                              class="absolute top-0.5 left-0.5 w-5 h-5 rounded-full bg-ayu-bg1 shadow transform transition-transform duration-200 flex items-center justify-center">
                            <i id="theme-icon-sun" class="fas fa-sun text-ayu-yellow text-[10px] hidden"></i>
                            <i id="theme-icon-moon" class="fas fa-moon text-ayu-blue text-[10px]"></i>
                        </span>
                    </button>

                    <!-- User Menu Desktop -->
                    {% if user.is_authenticated %}
                        <div class="flex items-center space-x-3 pl-3 border-l border-ayu-bg3">
                            <span class="text-sm text-ayu-fg4 max-w-32 truncate">{{ user.email }}</span>
                            <a href="{% url 'users:logout' %}"
                               class="flex items-center space-x-1.5 bg-ayu-bg2 hover:bg-ayu-bg3 text-ayu-fg2 hover:text-ayu-red px-3 py-1.5 rounded-lg text-sm font-medium transition-all">
                                <i class="fas fa-sign-out-alt text-xs"></i>
                                <span>Выйти</span>
                            </a>
                        </div>
                    {% else %}
                        <div class="flex items-center space-x-2 pl-3 border-l border-ayu-bg3">
                            <a href="{% url 'users:login' %}"
                               class="text-ayu-fg3 hover:text-ayu-fg0 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors">
                                Вход
                            </a>
                            <a href="{% url 'users:register' %}"
                               class="bg-ayu-orange hover:bg-ayu-orangeBright text-white px-4 py-1.5 rounded-lg text-sm font-medium transition-colors">
                                Регистрация
                            </a>
                        </div>
                    {% endif %}
                </div>

                <!-- Mobile Controls -->
                <div class="mobile-controls items-center space-x-2" style="display: flex;">
                    <!-- Theme Toggle Mobile (always visible) -->
                    <button id="theme-toggle-mobile" type="button"
                            class="relative w-10 h-5 rounded-full bg-ayu-bg3 transition-colors duration-200 focus:outline-none"
                            aria-label="Toggle theme">
                        <span id="theme-toggle-thumb-mobile"
                              class="absolute top-0.5 left-0.5 w-4 h-4 rounded-full bg-ayu-bg1 shadow transform transition-transform duration-200 flex items-center justify-center">
                            <i id="theme-icon-sun-mobile" class="fas fa-sun text-ayu-yellow text-[8px] hidden"></i>
                            <i id="theme-icon-moon-mobile" class="fas fa-moon text-ayu-blue text-[8px]"></i>
                        </span>
                    </button>

                    <!-- Burger Menu Button -->
                    <button type="button" id="mobile-menu-button"
                            class="text-ayu-fg3 hover:text-ayu-fg0 hover:bg-ayu-bg2 p-2 rounded-lg transition-all">
                        <i class="fas fa-bars text-lg"></i>
                    </button>
                </div>
            </div>

            <!-- Mobile Menu -->
            <div class="mobile-menu hidden" id="mobile-menu">
                <div class="py-3 space-y-1 border-t border-ayu-bg3">
                    <a href="{% url 'lecture:home' %}"
                       class="flex items-center px-3 py-2.5 text-ayu-fg2 hover:text-ayu-fg0 hover:bg-ayu-bg2 rounded-lg text-base font-medium transition-all">
                        <i class="fas fa-home w-6 text-ayu-fg4"></i>
                        Главная
                    </a>
                    <a href="{% url 'lecture:lecturers_list' %}"
                       class="flex items-center px-3 py-2.5 text-ayu-fg2 hover:text-ayu-fg0 hover:bg-ayu-bg2 rounded-lg text-base font-medium transition-all">
                        <i class="fas fa-users w-6 text-ayu-fg4"></i>
                        Лекторы
                    </a>
                    <a href="{% url 'lecture:topics_list' %}"
                       class="flex items-center px-3 py-2.5 text-ayu-fg2 hover:text-ayu-fg0 hover:bg-ayu-bg2 rounded-lg text-base font-medium transition-all">
                        <i class="fas fa-book w-6 text-ayu-fg4"></i>
                        Темы
                    </a>
                    <a href="{% url 'lecture:now_listening_list' %}"
                       class="flex items-center px-3 py-2.5 text-ayu-fg2 hover:text-ayu-fg0 hover:bg-ayu-bg2 rounded-lg text-base font-medium transition-all">
                        <i class="fas fa-headphones w-6 text-ayu-fg4"></i>
                        Сейчас слушают
                    </a>

                    {% if user.is_authenticated %}
                    <div class="border-t border-ayu-bg3 mt-2 pt-2">
                        <a href="{% url 'lecture:favorites_list' %}"
                           class="flex items-center px-3 py-2.5 text-ayu-fg2 hover:text-ayu-fg0 hover:bg-ayu-bg2 rounded-lg text-base font-medium transition-all">
                            <i class="fas fa-heart w-6 text-ayu-red"></i>
                            Избранное
                        </a>
                        <a href="{% url 'lecture:history_list' %}"
                           class="flex items-center px-3 py-2.5 text-ayu-fg2 hover:text-ayu-fg0 hover:bg-ayu-bg2 rounded-lg text-base font-medium transition-all">
                            <i class="fas fa-history w-6 text-ayu-fg4"></i>
                            История
                        </a>
                    </div>
                        <div class="border-t border-ayu-bg3 mt-2 pt-2">
                            <div class="px-3 py-2 text-sm text-ayu-fg4 truncate">
                                <i class="fas fa-user w-6 text-ayu-fg4"></i>
                                {{ user.email }}
                            </div>
                            <a href="{% url 'users:logout' %}"
                               class="flex items-center px-3 py-2.5 text-ayu-red hover:bg-ayu-bg2 rounded-lg text-base font-medium transition-all">
                                <i class="fas fa-sign-out-alt w-6"></i>
                                Выйти
                            </a>
                        </div>
                    {% else %}
                        <div class="border-t border-ayu-bg3 mt-2 pt-2 space-y-1">
                            <a href="{% url 'users:login' %}"
                               class="flex items-center px-3 py-2.5 text-ayu-fg2 hover:text-ayu-fg0 hover:bg-ayu-bg2 rounded-lg text-base font-medium transition-all">
                                <i class="fas fa-sign-in-alt w-6 text-ayu-fg4"></i>
                                Вход
                            </a>
                            <a href="{% url 'users:register' %}"
                               class="flex items-center px-3 py-2.5 text-ayu-orange hover:bg-ayu-bg2 rounded-lg text-base font-medium transition-all">
                                <i class="fas fa-user-plus w-6"></i>
                                Регистрация
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </header>

    {% if messages %}
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-4">
            {% for message in messages %}
                <div class="mb-4 p-4 rounded-lg {% if message.tags == 'error' %}bg-ayu-bg2 text-ayu-redBright border border-ayu-red{% elif message.tags == 'success' %}bg-ayu-bg2 text-ayu-greenBright border border-ayu-green{% else %}bg-ayu-bg2 text-ayu-blueBright border border-ayu-blue{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <main class="px-4 py-4 pb-20">
        {% block content %}{% endblock %}
    </main>

    <script>
        document.getElementById('mobile-menu-button').addEventListener('click', function() {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        });

        // Theme Toggle
        (function() {
            const themeToggle = document.getElementById('theme-toggle');
            const themeToggleMobile = document.getElementById('theme-toggle-mobile');
            const thumb = document.getElementById('theme-toggle-thumb');
            const thumbMobile = document.getElementById('theme-toggle-thumb-mobile');
            const sunIcon = document.getElementById('theme-icon-sun');
            const moonIcon = document.getElementById('theme-icon-moon');
            const sunIconMobile = document.getElementById('theme-icon-sun-mobile');
            const moonIconMobile = document.getElementById('theme-icon-moon-mobile');

            function updateToggleUI(isLight) {
                // Desktop toggle (w-12, thumb w-5, offset = 12 - 5 - 0.5 padding = 1.5rem)
                if (thumb) {
                    thumb.style.transform = isLight ? 'translateX(1.5rem)' : 'translateX(0)';
                }
                if (sunIcon && moonIcon) {
                    sunIcon.classList.toggle('hidden', !isLight);
                    moonIcon.classList.toggle('hidden', isLight);
                }

                // Mobile toggle (w-10, thumb w-4, offset = 10 - 4 - 0.5 padding = 1.25rem)
                if (thumbMobile) {
                    thumbMobile.style.transform = isLight ? 'translateX(1.25rem)' : 'translateX(0)';
                }
                if (sunIconMobile && moonIconMobile) {
                    sunIconMobile.classList.toggle('hidden', !isLight);
                    moonIconMobile.classList.toggle('hidden', isLight);
                }
            }

            function toggleTheme() {
                const currentTheme = document.documentElement.className;
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

                document.documentElement.className = newTheme;
                localStorage.setItem('theme', newTheme);
                updateToggleUI(newTheme === 'light');
            }

            // Initialize toggle UI
            const currentTheme = localStorage.getItem('theme') || 'dark';
            updateToggleUI(currentTheme === 'light');

            // Add event listeners
            if (themeToggle) {
                themeToggle.addEventListener('click', toggleTheme);
            }
            if (themeToggleMobile) {
                themeToggleMobile.addEventListener('click', toggleTheme);
            }
        })();
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>
